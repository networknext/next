version: v1.0

name: Build

agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804

blocks:

  - name: "relay"
    dependencies: []
    task:
      prologue:
        commands:
          - checkout
      agent:
        machine:
          type: e1-standard-8
          os_image: ubuntu2004
      jobs:
        - name: build
          commands:
            - sudo apt-get install -y libsodium-dev
            - gcc --version
            - make -j
            - ./bin/relay version
            - artifact push workflow ./bin/relay

promotions:

  - name: "Deploy"
    pipeline_file: deploy.yml
