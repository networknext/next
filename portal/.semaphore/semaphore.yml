version: v1.0
name: Frontend Tests
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
  containers:
    - name: main
      image: nbopardi/networknext:portal
global_job_config:
  prologue:
    commands:
      - checkout
      - mv /node_modules ./node_modules
fail_fast:
  stop:
    when: "true" # stop all jobs upon first failure
blocks:
  - name: Lint & Tests
    task:
      jobs:
        - name: Frontend Linting
          commands:
            - npm run lint
        - name: Frontend Unit
          commands:
            - npm run test:unit
        ## - name: Frontend E2E
          ## commands:
            ## - npm run test:e2e
promotions:
  - name: Development Deployment
    pipeline_file: development-deploy.yml
    auto_promote:
      when: branch = 'dev' AND result = 'passed'
  - name: Staging Deployment
    pipeline_file: staging-deploy.yml
    auto_promote:
      when: branch = 'staging' AND result = 'passed'
  - name: Production Deployment
    pipeline_file: production-deploy.yml
    auto_promote:
      when: branch = 'prod' AND result = 'passed'
