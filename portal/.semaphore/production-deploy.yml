version: v1.0
name: Production Deploy
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
  containers:
    - name: main
      image: nbopardi/networknext:portal-deploy
global_job_config:
  prologue:
    commands:
      - gcloud auth activate-service-account --key-file=/home/semaphore/gcp-service-account.json
      - gcloud auth configure-docker -q
      - checkout
      - mv /node_modules ./node_modules
blocks:
  - name: Build & Publish Artifacts
    dependencies: []
    task:
      jobs:
        - name: Portal
          commands:
            - make build-portal-artifacts-prod
      secrets:
        - name: google-cloud-platform-prod
