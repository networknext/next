
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Upgraded Server Example &#8212; Network Next SDK 3.4.5 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Complex Client Example" href="complex_client_example.html" />
    <link rel="prev" title="Upgraded Client Example" href="upgraded_client_example.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="upgraded-server-example">
<h1>Upgraded Server Example<a class="headerlink" href="#upgraded-server-example" title="Permalink to this headline">¶</a></h1>
<p>In this example we setup a server for monitoring and acceleration by network next.</p>
<p>First define configuration values for the server:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">bind_address</span> <span class="o">=</span> <span class="s">&quot;0.0.0.0:50000&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">server_address</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1:50000&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">server_datacenter</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">backend_hostname</span> <span class="o">=</span> <span class="s">&quot;dev.networknext.com&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">customer_private_key</span> <span class="o">=</span> <span class="s">&quot;leN7D7+9vr3TEZexVmvbYzdH1hbpwBvioc6y1c9Dhwr4ZaTkEWyX2Li5Ph/UFrw8QS8hAD9SQZkuVP6x14tEcqxWppmrvbdn&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This includes the test customer private key we’re using in this example. A customer private key is required on the server to enable acceleration by Network Next.</p>
<p>Next, initialize a configuration struct to defaults, then copy the hostname and the customer private key on top.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_config_t</span> <span class="n">config</span><span class="p">;</span>
<span class="n">next_default_config</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">config</span> <span class="p">);</span>
<span class="n">strncpy</span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">backend_hostname</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">hostname</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">strncpy</span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">customer_private_key</span><span class="p">,</span> <span class="n">customer_private_key</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customer_private_key</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">next_init</span><span class="p">(</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">config</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">NEXT_OK</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;error: could not initialize network next</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>IMPORTANT: Generally speaking it’s bad form to include a private key in your codebase like this, it’s done here only to make this example easy to use. In production environments, we strongly recommend passing in “” for your customer private key, and setting it via the environment variable: <em>NEXT_CUSTOMER_PRIVATE_KEY</em> which overrides the value specified in code.</p>
<p>Next we initialize the SDK, this time passing in the configuration struct.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">next_init</span><span class="p">(</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">config</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">NEXT_OK</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;error: could not initialize network next</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we define a function to be called when packets are received from clients.</p>
<p>Here is one that reflects the packet back to the client that sent it, and upgrades the client that sent the packet for monitoring and acceleration by Network Next.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_server_send_packet</span><span class="p">(</span> <span class="n">server</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">packet_data</span><span class="p">,</span> <span class="n">packet_bytes</span> <span class="p">);</span>

<span class="n">next_printf</span><span class="p">(</span> <span class="n">NEXT_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">&quot;server received packet from client (%d bytes)&quot;</span><span class="p">,</span> <span class="n">packet_bytes</span> <span class="p">);</span>

<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">next_server_session_upgraded</span><span class="p">(</span> <span class="n">server</span><span class="p">,</span> <span class="n">from</span> <span class="p">)</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">user_id_string</span> <span class="o">=</span> <span class="s">&quot;12345&quot;</span><span class="p">;</span>
    <span class="n">next_server_upgrade_session</span><span class="p">(</span> <span class="n">server</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">user_id_string</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Generally you would <em>not</em> want to upgrade every client session you receive a packet from. This is just done to make this example easy to implement.</p>
<p>Instead, you should only upgrade sessions that have passed whatever security and protocol level checks you have in your game so you are 100% confident this is a real player joining your game.</p>
<p>Also notice that you can pass in a user id as a string to the upgrade call.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_server_upgrade_session</span><span class="p">(</span> <span class="n">server</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">user_id_string</span> <span class="p">);</span>
</pre></div>
</div>
<p>This user id is very important because it allows you to look up users by that id in our portal. Please make sure you set the user id to however you uniquely identify users in your game. For example, PSN ids, Steam Ids and so on. For privacy reasons, this user id is hashed before sending to our backend.</p>
<p>Now, create the server.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_server_t</span> <span class="o">*</span> <span class="n">server</span> <span class="o">=</span> <span class="n">next_server_create</span><span class="p">(</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">server_address</span><span class="p">,</span> <span class="n">bind_address</span><span class="p">,</span> <span class="n">server_datacenter</span><span class="p">,</span> <span class="n">server_packet_received</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">server</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;error: failed to create server</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Make sure the server gets updated every frame:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_server_update</span><span class="p">(</span> <span class="n">server</span> <span class="p">);</span>
</pre></div>
</div>
<p>When you have finished using your server, please destroy it:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_server_destroy</span><span class="p">(</span> <span class="n">server</span> <span class="p">);</span>
</pre></div>
</div>
<p>Before your application terminates, please shut down the SDK:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">next_term</span><span class="p">();</span>
</pre></div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Network Next SDK</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How it works</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_the_sdk.html">Building the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="simple_client_example.html">Simple Client Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="simple_server_example.html">Simple Server Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgraded_client_example.html">Upgraded Client Example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgraded Server Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_client_example.html">Complex Client Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_server_example.html">Complex Server Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="upgraded_client_example.html" title="previous chapter">Upgraded Client Example</a></li>
      <li>Next: <a href="complex_client_example.html" title="next chapter">Complex Client Example</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Network Next, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/upgraded_server_example.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>