semaphore-happy-path.yml

  - name: "Happy Path (Linux)"
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-8
          os_image: ubuntu2004
      jobs:

        - name: "make dev-happy-path"

          commands:

            - sudo apt-get install -y libsodium-dev redis-server

            - checkout
            - cd ~/backend/libs/zeromq
            - ./autogen.sh
            - ./configure --with-norm=no --with-pgm=no
            - make -j32
            - sudo make -j32 install
            - sudo ldconfig

            - cd ~/backend
            - cp envs/local.env .env
            - make dev-happy-path

  - name: "Happy Path (Mac)"
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu2004
      secrets:
        - name: build-machine-access
        - name: build-machine-known-hosts
      prologue:
        commands:
         - chmod 600 /home/semaphore/.ssh/id_rsa_build
         - ssh-add /home/semaphore/.ssh/id_rsa_build
      jobs:
        - name: "make dev-happy-path"
          commands:
           - ssh -J glenn@34.67.51.93 build@aquaman -p 22 "cd build && ./build.sh backend happy-path"

  - name: "Happy Path (WSL)"
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu2004
      secrets:
        - name: build-machine-access
        - name: build-machine-known-hosts
      prologue:
        commands:
         - chmod 600 /home/semaphore/.ssh/id_rsa_build
         - ssh-add /home/semaphore/.ssh/id_rsa_build
      jobs:
        - name: "make dev-happy-path"
          commands:
           - ssh -J glenn@34.67.51.93 build@thor -p 2222 "cd /mnt/c/build && ./build.sh backend happy-path"
